// Generated by CoffeeScript 1.6.3
var Checker;

Checker = (function() {
  function Checker() {
    this.error = '';
  }

  Checker.prototype.isError = function() {
    return !(this.error.length === 0);
  };

  Checker.prototype.isTitle = function(title) {
    if (title.length === 0) {
      this.error = "Event Title Not Empty";
    }
    return this;
  };

  Checker.prototype.isTime = function(time) {
    if (time.length === 0) {
      this.error = "Event Time Not Empty";
    } else if (!/^(201[0-9])-((0[1-9])|(1[0-2]))-((0[1-9])|([1-2][0-9])|(3[0-1]))$/.test(time)) {
      this.error = "Event Time Format Error";
    }
    return this;
  };

  Checker.prototype.isLocation = function(loc) {
    if (loc.length === 0) {
      this.error = "Event Location Not Empty";
    }
    return this;
  };

  Checker.prototype.isContent = function(con) {
    if (con.length === 0) {
      this.error = "Event Content Not Empty";
    }
    return this;
  };

  return Checker;

})();

$(document).ready(function() {
  var dispaly_error_info, elm_alert, elm_err, hidden_error_info;
  $("div#e_s_datetimepicker").datetimepicker({
    pickTime: false
  });
  $("textarea#e_s_content").wysihtml5({
    'stylesheets': ['/bootstrap/css/wysiwyg-color.css']
  });
  elm_alert = $("div#l_alert");
  elm_err = $(elm_alert.children('p').get(0));
  dispaly_error_info = function(err) {
    elm_alert.show();
    return elm_err.html(err);
  };
  hidden_error_info = function() {
    elm_alert.hide();
    return elm_err.html('');
  };
  $("button.a_e_cancel").click(function() {
    return window.location.href = "/wlg/setting/event/page";
  });
  $("button.a_e_save").click(function() {
    var checker, e_content, e_location, e_time, e_title;
    hidden_error_info();
    e_title = $.trim($("input#e_s_title").val());
    e_time = $.trim($("input#e_s_time").val());
    e_location = $.trim($("input#e_s_location").val());
    e_content = $.trim($("textarea#e_s_content").val());
    checker = new Checker();
    if (checker.isTitle(e_title).isError()) {
      return dispaly_error_info(checker.error);
    }
    if (checker.isTime(e_time).isError()) {
      return dispaly_error_info(checker.error);
    }
    if (checker.isLocation(e_location).isError()) {
      return dispaly_error_info(checker.error);
    }
    if (checker.isContent(e_content).isError()) {
      return dispaly_error_info(checker.error);
    }
    $.ajax({
      type: 'POST',
      url: '/wlg/setting/event/add',
      data: {
        e_s_title: e_title,
        e_s_time: e_time,
        e_s_loc: e_location,
        e_s_cont: e_content
      },
      success: function(result) {
        console.log(result);
        result = eval('(' + result + ')');
        dispaly_error_info(result.info);
        if (result.status === true) {
          window.location.href = '/wlg/setting/event/page';
        }
      }
    });
  });
});
